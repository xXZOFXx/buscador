<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busqueda</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="stylesheet" href="css/index.css">
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.all.min.js"></script>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#"><img src="assets/z_labs.png" width="100px" alt=""></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">

            </div>
        </div>
    </nav>

    <!-- Full Page Image Header with Vertically Centered Content -->
    <header class="masthead">
        <div class="degradado">
            <div class="container h-100">
                <div class="row h-100 align-items-center">
                    <div class="col-12 text-center">
                        <img src="assets/z_labs.png" width="20%" class="rounded mx-auto d-block" alt="">

                        <h1 class="fw-light"><b>Busqueda concentrada de URL by<b><a
                                        href="https://www.smartekh.com/"></a>
                                    smartekh</a></b> </h1>
                        <p class="lead"> </p>
                        <p class="lead"> <b>El objetivo de este sitio es facilitar al usuario la busqueda de URL de
                                diferentes dominios en uno</b></p>


                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="Escribe ip" aria-label="escribe ip"
                                aria-describedby="basic-addon2" id="ipsearch">
                            <div class="input-group-append">
                                <button class="btn btn-outline-light" id="activabtnip" type="button">Buscar</button>
                            </div>
                        </div>






                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container Respuesta">

        <div class="row">

            <div class="col-md-12">

              <!--  <div id="maluno"></div>-->
                <div id="reptotal">

                </div> <img src="" class="rounded mx-auto d-block" width="10%" style="margin: 20%;" alt="country" id="IMG">
            </div>
            <div class="col-md-4">

                <div class="carta">
                    <div class="contenedorvirust"></div>
                    <div id="paisc"></div> <br>
                    <div id="isponex"></div> <br>
                    <div id="ofus"></div>
                </div>




            </div>
            <div class="col-md-4">

                <div class="carta">
                    <div class="contenedorvirusdos"></div>
                    <div id="dominiodos"></div>  <br>
                    <div id="ipdosxd"></div>
                    <div id="ispone"></div>
                    
                </div>








            </div>

            <div class="col-md-4">
                <div class="carta">
                    <div class="contenedorvirustres"></div>
                    <div id="dominio"></div>  <br>

                    <div id="score"></div>
                    <div id="dominioatx"></div>
                    
                    
                </div>


            </div>

        </div>
    </div>





    <footer class="text-center text-white" style="background-color: black;">
        <!-- Grid container -->
        <div class="container pt-4">
            <!-- Section: Social media -->
            <section class="mb-4">


                <!-- Facebook -->
                <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="https://www.facebook.com/" role="button"
                    data-mdb-ripple-color="dark"><i class="fab fa-facebook-f" style="color: white;"></i></a>




                <!-- Instagram -->
                <a class="btn btn-link btn-floating btn-lg text-dark m-1" href="https://www.instagram.com/"
                    role="button" data-mdb-ripple-color="dark"><i class="fab fa-instagram"
                        style="color: white;"></i></a>



            </section>
            <!-- Section: Social media -->
        </div>
        <!-- Grid container -->

        <!-- Copyright -->
        <div class="text-center text-white p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            © 2022 Copyright:
            <a class="text-white" href="https://smartekh.com/">smartekh.com</a>




        </div>
        <!-- Copyright -->
    </footer>



</body>
<script src="https://kit.fontawesome.com/4db3f6d2e0.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
    crossorigin="anonymous"></script>
<script>

    var now = new Date();
    var today = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate();
    $('#fechaFin').val(today);

    $('#txtinput').val(today);

</script>



<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="js/jquery-3.6.3.min.js"></script>

<script>






    document.getElementById("activabtnip").addEventListener("click", ejecuta);


    const aplicacion = document.querySelector(".contenedorvirust"); //se hace la referencia en donde vendrá todo el pedo 
    const aplicacionuno = document.querySelector(".contenedorvirusdos");

    const aplicaciondos = document.querySelector(".contenedorvirustres");

    function ejecuta() {
        virustotal();
        abuse();
        alienfetch();
    }

    function virustotal() {

        let ipbusqueda = document.getElementById("ipsearch").value;


        var myHeaders = new Headers();
        myHeaders.append("X-Apikey", "d885a9806fb9a028c5cc0d85624b0c140cba58a0fff7227a986d6d2dee8237a9");

        var requestOptions = {
            method: 'GET',
            headers: myHeaders,
            redirect: 'follow'
        };

        fetch("https://cors-anywhere.herokuapp.com/https://www.virustotal.com/api/v3/ip_addresses/" + ipbusqueda, requestOptions)
            .then(respuesta => respuesta.json())
            .then(datos => {//haciendo iteracion



                let pais = datos['data']['attributes']['country']

                let prop = (datos['data']['attributes']['as_owner']);
                let es = (datos['data']['attributes']['network']);
                let maligno = (datos['data']['attributes']['last_analysis_results']['Bkav']['method']);

                //imprimiendo usuario en pantalla



                let paism = document.getElementById('paisc');
                paism.innerHTML = 'pais: ' + pais;

                let propow = document.getElementById('isponex');
                propow.innerHTML = 'Dominio: ' + prop;


                let esofu = document.getElementById('ofus');
                esofu.innerHTML = 'IP: ' + es;

                let mal = document.getElementById('maluno');

                mal.innerHTML = 'estatus: ' + maligno;




                const p = document.createElement('p');

                p.innerHTML = '<h2>Virus total :</h2> <br><img src="assets/VirusTotal-nuevo-logo-2493322606.png" width="80%" class="rounded mx-auto d-block" alt="">'







                aplicacion.appendChild(p)




            }).catch(error => console.log("error 1 en fetch" + error))





    }




    function abuse() {

        let ipbusqueda = document.getElementById("ipsearch").value;


        var myHeader = new Headers();
        myHeader.append("key", "6415fee99d33ccbe870e9ef80414b83c056b0bbcc8e54fdaad727007ae768b3ef0605e9814b6f44c");

        var requestOptionss = {
            method: 'GET',
            headers: myHeader,
            redirect: 'follow'
        };

        fetch("https://cors-anywhere.herokuapp.com/https://api.abuseipdb.com/api/v2/check?ipAddress=" + ipbusqueda, requestOptionss)
            .then(response => response.json())
            .then(result => {

                console.log(result);


                let paisdos = result['data']['countryCode']
                let ispdos = result['data']['isp']
                let direcciondos = result['data']['ipAddress']
                let reportesabus = result['data']['totalReports']
                console.log(result.countryCode);
                //imprimiendo usuario en pantalla

                let dominiodos = document.getElementById('dominiodos');
                dominiodos.innerHTML = 'pais: ' + paisdos;

                let isp = document.getElementById('ispone');
                isp.innerHTML = 'Dominio: ' + ispdos;

                let direccionipdos = document.getElementById('ipdosxd');
                direccionipdos.innerHTML = 'ip: ' + direcciondos;

                let reportestotales = document.getElementById('reptotal');


                    if (reportesabus >=1 ) {
                        reportestotales.innerHTML = 'Reportes totales: 🏴‍☠️ ' + reportesabus;
                    }else{

                       
                        reportestotales.innerHTML = 'No hay reportes <span style="font-size:100px;">&#128513;</span>';


                    }

                const b = document.createElement('p');


                b.innerHTML = '<h2>AbuseIP :</h2> <br><img src="assets/abuseipdb-logo.svg" width="50%" class="rounded mx-auto d-block" alt="">'


                aplicacionuno.appendChild(b)



            })


            .catch(error => console.log('error', error));


    }


    function alienfetch() {

        let ipbusqueda = document.getElementById("ipsearch").value;


        // const IPV4= document.getElementById('IP');
        // let Ipv4 = "20.241.59.211";

        const Link = `https://cors-anywhere.herokuapp.com/https://otx.alienvault.com/api/v1/indicators/IPv4/${ipbusqueda}/general`;
        fetch(Link).then(response => response.json())
            .then((json) => {
                // let inform= document.getElementById('Info');
                //inform.innerHTML = json.country_name;
                console.log(json);


                /*nuevo formato*/
                const c = document.createElement('p');

                c.innerHTML = '<h2>otx :</h2> <br><img src="assets/otx.png" width="80%" class="rounded mx-auto d-block" alt="">'

                aplicaciondos.appendChild(c)




                let dominio = document.getElementById('dominio');
                dominio.innerHTML = 'pais: ' + json.country_name;

                let puntage = document.getElementById('score');
                puntage.innerHTML = 'ip: ' + json.indicator;

                let tipoip = document.getElementById('tipoip');
                // let pubpriv = (json['data']['base_indicator']['access_type']);


                let dominivn = document.getElementById('dominioatx');

                dominivn.innerHTML = 'Dominio' + json.asn;

              

                const fot =document.getElementById('IMG');

        fot.src= "https://otx.alienvault.com" + json.flag_url;

            })

    }


</script>

</html>